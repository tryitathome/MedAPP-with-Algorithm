# 图片压缩功能说明

## 功能概述

为了优化用户体验和系统性能，我们在口腔AI综合检测平台中集成了智能图片压缩功能。该功能会在用户上传图片时自动进行压缩处理，确保图片大小适合医学影像分析的同时，减少加载时间和存储空间。

## 压缩规格

### 默认压缩参数
- **最大尺寸**: 1600 × 1200 像素
- **文件大小限制**: 500KB 以内
- **图片质量**: 80% (0.8)
- **支持格式**: JPEG, PNG, WebP

### 自动处理流程
1. 用户选择图片文件
2. 系统自动检测图片尺寸和大小
3. 如果超出限制，则进行智能压缩
4. 压缩过程中显示实时进度
5. 压缩完成后显示统计信息

## 使用场景

### 1. 单张图片上传
- 点击"选择待检图片文件"按钮
- 选择一张图片文件
- 系统自动压缩并显示进度
- 压缩完成后可立即进行诊断

### 2. 批量文件夹上传
- 点击"添加患者文件夹"按钮
- 选择包含多张图片的文件夹
- 系统批量压缩所有图片
- 显示总体压缩统计信息

## 界面提示

### 压缩进度显示
- 蓝色进度条显示压缩进度
- 实时显示"当前处理/总数"信息
- 显示百分比进度

### 压缩完成统计
- 绿色提示框显示压缩结果
- 包含以下信息：
  - 处理的图片数量
  - 压缩前后文件大小对比
  - 总体压缩率
- 5秒后自动消失（可手动关闭）

## 技术特性

### 智能压缩算法
- 基于HTML5 Canvas API
- 自适应尺寸调整
- 质量优化平衡
- 保持医学影像关键细节

### 性能优化
- 异步处理，不阻塞界面
- 批量处理时的进度反馈
- 内存管理优化
- 支持大文件处理

### 兼容性保证
- 保持原有的文件上传接口
- 向后兼容现有代码
- 自动回退机制

## 压缩效果示例

### 典型压缩场景
```
原始图片: 3000×2000, 2.5MB → 压缩后: 1500×1000, 450KB (压缩率: 82%)
原始图片: 4096×3072, 5.2MB → 压缩后: 1600×1200, 480KB (压缩率: 91%)
原始图片: 1920×1080, 800KB → 压缩后: 1600×900, 320KB (压缩率: 60%)
```

### 医学影像质量保证
- 保持关键诊断信息
- 优化文件传输效率
- 减少服务器存储压力
- 提升用户体验

## 错误处理

### 支持的错误场景
- 文件格式不支持 → 显示错误提示
- 文件损坏 → 压缩失败提示
- 网络中断 → 重试机制
- 内存不足 → 优雅降级

### 用户友好提示
- 明确的错误信息
- 建议的解决方案
- 重试操作指导

## 开发者信息

### 核心文件
- `utils/imageCompression.ts` - 压缩算法核心
- `hooks/useFileUploadWithCompression.ts` - 上传压缩集成
- `components/ui/CompressionProgress.tsx` - 进度显示组件

### 配置选项
可通过 `CompressionOptions` 接口自定义压缩参数：
```typescript
interface CompressionOptions {
  maxWidth?: number;     // 最大宽度
  maxHeight?: number;    // 最大高度  
  maxSizeKB?: number;    // 最大文件大小(KB)
  quality?: number;      // 图片质量(0-1)
}
```

### 测试工具
使用 `test/imageCompressionTest.ts` 进行功能测试：
- 单张图片压缩测试
- 批量图片压缩测试
- 不同压缩选项对比测试

## 更新日志

### v1.0.0 (当前版本)
- ✅ 集成智能图片压缩功能
- ✅ 支持单张和批量图片处理
- ✅ 实时进度显示
- ✅ 压缩统计反馈
- ✅ 错误处理机制
- ✅ 保持医学影像诊断质量

## 注意事项

1. **医学影像质量**: 压缩算法经过优化，确保不影响诊断准确性
2. **处理时间**: 大文件或批量处理可能需要几秒钟时间
3. **浏览器兼容**: 需要现代浏览器支持（Chrome 80+, Firefox 75+, Safari 13+）
4. **文件大小**: 建议单张图片不超过50MB
5. **批量处理**: 建议批量上传不超过100张图片

---

*如有技术问题，请联系开发团队或查看控制台日志获取详细信息。*
